# 产品需求文档 (PRD): Expense & Budget SPA - V2.0

---

## 1. 项目概述

**项目名称:** Expense & Budget SPA (个人财务管理单页应用)

**目标:**
- **业务目标:** 为用户提供一个完整的个人财务管理工具，支持收支记录、预算控制、余额跟踪，并直观地了解个人财务状况。
- **学习目标:** 深度掌握 React 生态中的核心与进阶知识点，包括 React Router、`useReducer`、`useMemo`、`useCallback`、`useEffect`、Context API、多状态管理、自定义Hook等，并结合 `localStorage` 实现数据持久化。

**目标用户:** 期望通过构建一个完整的 SPA 项目来巩固和提升 React 技能的开发者。

---

## 2. 核心功能

### 2.1 用户故事

| 模块 | 用户故事 ID | 作为用户, 我想要... | 以便我能够... | 验收标准 (AC) | 涉及知识点 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **记账管理** | **US-001** | 新增一笔支出，包含金额、类别、日期和备注 | 记录我的每一笔花费 | 1. 提供一个表单，包含金额(数字)、类别(下拉选择)、日期(日期选择器)、备注(文本框)输入字段。<br>2. 提交后，新的支出项会出现在支出列表中。<br>3. 表单提交后被清空。 | `useState`, `useReducer` |
| | **US-002** | 编辑一笔已存在的支出记录 | 修正录入的错误信息 | 1. 每条支出记录旁都有一个 "编辑" 按钮。<br>2. 点击后，表单中会填入该记录的现有数据。<br>3. 提交后，对应记录在列表中被更新。 | `useState`, `useReducer` |
| | **US-003** | 删除一笔支出记录 | 移除不再需要或错误的记录 | 1. 每条支出记录旁都有一个 "删除" 按钮。<br>2. 点击并确认后，该记录从列表中移除。 | `useReducer` |
| **支出过滤** | **US-011** | 按月度过滤支出记录 | 快速查看特定月份的支出情况 | 1. 支出页面包含月份选择器，与Dashboard的月度过滤保持一致。<br>2. 选择月份后，列表只显示该月的支出记录。<br>3. 支出统计信息同步更新。 | `useMemo`, `useState` |
| | **US-012** | 按类别过滤支出记录 | 快速查看特定类别的所有支出 | 1. 支出页面包含类别多选下拉框。<br>2. 可同时选择多个类别进行筛选。<br>3. 支持"全选"和"清空"操作。 | `useMemo`, `useState` |
| | **US-013** | 按日期范围筛选支出 | 查看任意时间段的支出情况 | 1. 提供开始日期和结束日期选择器。<br>2. 支出列表实时更新显示指定范围内的记录。<br>3. 提供常用时间段快捷选择（本周、本月、上月）。 | `useMemo`, 日期处理 |
| | **US-014** | 按金额范围筛选支出 | 查找特定金额区间的支出 | 1. 提供最小金额和最大金额输入框。<br>2. 支出列表根据金额范围实时筛选。<br>3. 显示筛选结果的统计信息。 | `useMemo`, `useState` |
| | **US-015** | 搜索支出记录 | 通过备注内容快速找到特定支出 | 1. 提供搜索输入框。<br>2. 支持按备注内容模糊搜索。<br>3. 高亮显示匹配的关键词。 | `useMemo`, 字符串处理 |
| **收入管理** | **US-016** | 新增收入记录 | 记录我的各项收入来源 | 1. 提供收入录入表单，包含金额、来源、日期、备注字段。<br>2. 收入来源支持：工资、兼职、投资、其他等。<br>3. 新增后在收入列表中显示。 | `useState`, `useReducer` |
| | **US-017** | 管理收入记录 | 修正或删除收入信息 | 1. 支持编辑和删除收入记录。<br>2. 收入数据与支出数据独立管理。<br>3. 收入修改后相关统计实时更新。 | `useReducer`, `Context` |
| **余额跟踪** | **US-018** | 查看账户余额状况 | 了解当前可用资金情况 | 1. Dashboard显眼位置展示当前余额（总收入-总支出）。<br>2. 余额计算实时更新，性能优化。<br>3. 支持按月度查看余额变化。 | `useMemo`, 跨Context计算 |
| | **US-019** | 余额变化趋势分析 | 了解财务健康状况的变化 | 1. 显示月度余额变化趋势。<br>2. 标识正向和负向变化。<br>3. 提供余额预警提示。 | `useMemo`, 数据分析 |
| **快速记账** | **US-020** | 使用预设模板快速记账 | 减少重复输入，提高记账效率 | 1. 支持创建常用支出模板（如：早餐、地铁、房租）。<br>2. 一键使用模板创建支出记录。<br>3. 模板支持编辑和删除。 | `useState`, 自定义Hook |
| | **US-021** | 智能推荐常用支出 | 基于历史数据提供便捷选择 | 1. 分析用户常用的支出模式。<br>2. 在记账时提供智能建议。<br>3. 支持一键填入建议内容。 | `useMemo`, 数据挖掘 |
| **预算管理** | **US-004** | 为不同的支出类别设置月度预算 | 控制我在各个领域的消费 | 1. 在专门的预算页面 (`/budget`)，可以为每个类别输入预算金额。<br>2. 设置的预算金额被成功保存。 | `useState`, `useReducer` |
| | **US-005** | 查看每个类别的预算使用情况 | 了解我的消费是否超支 | 1. 预算页面清晰展示各类别"已用金额"、"预算金额"与"剩余额度"。<br>2. "已用金额" 能实时根据支出记录更新。 | `useMemo` |
| **统计面板** | **US-006** | 在统计面板看到当月总支出 | 快速了解本月的整体财务状况 | 1. 仪表盘页面 (`/dashboard`) 显眼位置展示当月所有支出的总和。<br>2. 该计算值应在支出数据变化时自动更新。 | `useMemo` |
| | **US-007** | 在统计面板看到各类别支出占比 | 分析我的主要消费方向 | 1. 仪表盘以列表或图表形式，展示各类别支出占当月总支出的百分比。<br>2. 该数据应由支出记录派生计算得出，且性能开销合理。 | `useMemo` |
| **应用设置** | **US-022** | 管理支出类别 | 自定义适合自己的支出分类 | 1. 在设置页面支持添加、删除、重命名支出类别。<br>2. 类别修改后，现有数据保持一致性。<br>3. 预置常用类别，支持恢复默认。 | `useReducer`, 数据迁移 |
| | **US-023** | 设置默认值 | 简化日常记账操作 | 1. 设置默认支出类别和常用金额。<br>2. 新记录表单自动填入默认值。<br>3. 支持重置为系统默认设置。 | `Context`, `localStorage` |
| | **US-024** | 数据管理 | 保护和管理个人财务数据 | 1. 支持导出所有数据为JSON格式。<br>2. 支持导入数据文件。<br>3. 提供清空所有数据和重置应用功能。 | `useEffect`, 文件操作 |
| **应用基础** | **US-008** | 在不同功能页面间自由导航 | 方便地使用应用的各项功能 | 1. 应用包含 `/dashboard`, `/expenses`, `/budget`, `/settings` 四个路由。<br>2. 提供一个常驻的导航栏，点击后可切换页面，且浏览器不发生刷新。 | `React Router` |
| | **US-009** | 我的所有数据（支出、收入和预算）可以在关闭浏览器后保留 | 不丢失我录入的宝贵数据 | 1. 所有的支出、收入记录和预算设置都存储在浏览器的 `localStorage` 中。<br>2. 当应用再次打开时，会自动从 `localStorage` 加载并显示之前的数据。 | `useEffect` |
| | **US-010** | 优化高频更新组件的性能 | 确保应用在高频操作（如快速修改金额）下依然流畅 | 1. 对于接收回调函数的子组件，使用 `React.memo` 进行包裹。<br>2. 传递给这些组件的回调函数，使用 `useCallback` 进行包裹以保持引用稳定，避免不必要的重渲染。 | `React.memo`, `useCallback` |

---

## 3. 数据架构设计

### 3.1 支出数据结构
```javascript
{
  id: string,           // 唯一标识符
  amount: number,       // 金额
  category: string,     // 类别
  note: string,         // 备注
  date: string,         // 支出发生日期 (YYYY-MM-DD)
  createdAt: string,    // 记录创建时间 (ISO字符串)
  updatedAt: string     // 最后修改日期 (ISO字符串)
}
```

### 3.2 收入数据结构
```javascript
{
  id: string,           // 唯一标识符
  amount: number,       // 金额
  source: string,       // 收入来源：工资、兼职、投资、其他
  note: string,         // 备注
  date: string,         // 收入日期 (YYYY-MM-DD)
  createdAt: string,    // 记录创建时间 (ISO字符串)
  updatedAt: string     // 最后修改日期 (ISO字符串)
}
```

### 3.3 预算数据结构
```javascript
[
  {
    date: string,       // "2024-01" 月份标识
    budgets: {
      '餐饮': number,
      '交通': number,
      '购物': number,
      // ... 其他类别
    }
  }
]
```

### 3.4 模板数据结构
```javascript
{
  id: string,
  name: string,         // "早餐"、"地铁"
  amount: number,
  category: string,
  note: string,
  isFrequent: boolean   // 常用模板标识
}
```

---

## 4. 技术栈

- **前端框架:** React 19
- **构建工具:** Vite
- **编程语言:** JavaScript
- **路由:** React Router
- **状态管理:** Context API + useReducer
- **样式:** 纯 CSS 或内联样式 (非本次练习重点)
- **数据持久化:** `localStorage`

---

## 5. 新增里程碑规划

### 里程碑 6: 支出过滤系统 (2-3 小时)
- 实现月度、类别、日期范围、金额范围、搜索等5种过滤功能
- 保持与Dashboard的过滤逻辑一致性
- 性能优化：大数据量下的高效筛选

### 里程碑 7: 收入管理系统 (3-4 小时)
- 创建IncomesContext和incomesReducer
- 实现收入的增删改功能
- 与支出系统保持架构一致性

### 里程碑 8: 余额跟踪系统 (2-3 小时)
- 跨Context数据整合计算
- 实时余额显示和趋势分析
- 余额预警功能

### 里程碑 9: 快速记账系统 (2-3 小时)
- 模板管理功能
- 智能推荐算法
- 自定义Hook开发

### 里程碑 10: 设置系统完善 (2-3 小时)
- 类别管理功能
- 默认值设置
- 数据导入导出

---

## 6. 非功能性需求

### 6.1 性能要求
- 支持1000+条记录的流畅操作
- 过滤操作响应时间 < 100ms
- 组件渲染优化，减少不必要的重渲染

### 6.2 用户体验
- 一致的交互模式和视觉设计
- 明确的操作反馈和错误提示
- 响应式布局（基础适配）

### 6.3 数据安全
- 本地数据加密存储（可选）
- 数据导出备份机制
- 操作撤销功能（高级特性）

---

## 7. 不在范围内的功能

- 用户认证与多用户系统
- 后端数据库存储
- 复杂的数据可视化图表
- 完整的响应式设计与移动端优化
- 多语言国际化
- PWA功能